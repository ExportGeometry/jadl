# JSON Asset Definition Library for Houdini

Author: Mason Stevenson



JADL is a python library for saving/loading Houdini parameter configurations to/from JSON.



## Supported Versions

JADL was tested with the following Houdini version:

* Houdini 20.0.724



It may work for other versions, but use at your own discretion.



## Demo Videos

* [JADL with multiparm support](https://www.youtube.com/watch?v=0B7kYdJUYlY) (no sound)
* [Basic Topnet](https://www.youtube.com/watch?v=SSujIKtIvxA) (no sound)



## Installation

1) If you don't already have one, create a root directory for your houdini tools (anywhere on your machine).
2) Inside the root directory, create a folder named **python3.10libs** and add jadl.py to it.
3) Add the path to your root directory to HOUDINI_PATH in houdini.env (this file normally lives in Documents/HoudiniXX.X).
   1) It should look like: `HOUDINI_PATH = X:/Some/Path/To/RootToolsDir;&`
4) Restart Houdini if you have it open.
5) You can verify that jadl is installed by launching Houdini, opening the python shell (Windows->Python Shell), and running `__import__('jadl').about()` 



## Usage

In order to use JADL, you need to include the controls for loading and saving JSON files. To do this, simply add the JADL controls preset to your target node:

1) Right click your target HDA or subnet and either:
   1) Add to parameter interface: **Parameters and Channels -> Edit Parameter Interface**
   2) Add to type properties: **Type Properties -> Parameters**
2) Click the gear icon and select **Install Parameters From File...**
3) Install the currently supported JADL controls file
   1) To find out which controls file is supported by your version of JADL, open the python shell (Windows->Python Shell), and run `__import__('jadl').about()`.
4) (Optional) Hide the autogenerated root folder.
   1) by default, Houdini puts all of the parameters you just loaded inside a folder with a name that matches the file you just loaded (*jadl_controls_vx.x.ds*). You can hide this nested folder by changing its folder type: **Select Folder -> Folder Type -> Borderless**.



Once you have imported the JADL controls, you should be good to go.



### Basic Controls (v1.4)

* Asset Definitions:
  * **Use Asset Definitions File**:
    * Enables JADL.
  * **Create File if Missing**:
    * When enabled, JADL will automatically create a .json file for you if the file defined by **Path to JSON file** is missing.
  * **Path to JSON file**:
    * This is the path to the .json file that you want to use.
  * **Reload file**:
    * Force reloads the current JSON file. Useful if you have manually edited the file. (See **Path to JSON file**)
  * **Asset Definition Name**:
    * This is the name of the current asset you are editing. You can switch between already saved assets by clicking the dropdown next to this field. If you have already selected an asset and wish to define a new one, you can select *New* from the dropdown next to this field.
  * **Revert Asset**:
    * Reverts the currently named asset to whatever is stored int the current JSON file (see **Asset Definition Name**, **Path to JSON file**)
  * **Save Asset**:
    * Saves the currently named asset (see **Asset Definition Name**)
  * **Delete Asset**:
    * Deletes the currently named asset (see **Asset Definition Name**)
* Dev
  * **Enable Logging**:
    * This toggles verbose python logging. When this is turned off, only a small subset of log messages (such as invalid filename errors) will be printed to the screen.
  * **Changed Parms**:
    * This is a special parameter that is used to track if the current asset definition is out of sync with the JSON file. DO NOT DELETE THIS.



### Parameter Usage

#### Regular Parameters

JADL uses special naming conventions to automatically update certain parameters on your target node. To create a "JADL enabled" parameter, simply prefix your parameter **Name** with `pi_` to indicate that it is a parameter ID: `pi_your_parameter_name`.



Additionally, add the following to the parameter's **Callback Script**:

```py
__import__('jadl').parm_changed(kwargs['node'], kwargs['parm'])
```



#### Multiparms

For multiparms, the process is slightly more complicated. 



##### Mutiparm Setup 1: Create Custom Block

Create your custom multiparm block using the following naming conventions:

* The multiparm block folder **Name** must be prefixed with the multiparm ID tag: `mpi_`.

  * For example: `mpi_your_custom_block`

* The multiparm value **Name**s must be prefixed with the standard JADL parameter ID tag (`pi_`) AND must be suffixed using the multiparm numbering syntax: `_#`. MAKE SURE YOU INCLUDE THE UNDERSCORE.

  * Example: 'pi_your_multiparm_value_#'

* For each multiparm value, add the following the the parameter's **Callback Script**:

  * ```py
    __import__('jadl').parm_changed(kwargs['node'], kwargs['parm'])
    ```



##### Multiparm Setup 2: Multiparm Controller

Create an Integer parameter with the same name as your custom multparm block name, except swap the multiparm ID prefix for the multiparm controller prefix `mpc_`. For example:

* If your multiparm block is named `mpi_your_custom_block`
* Name your new Integer parameter `mpc_your_custom_block`



Add the following to the multiparm controller's **Callback Script**:

```py
__import__('jadl').parm_changed(kwargs['node'], kwargs['parm'])
```



This step is necessary because Houdini cannot directly trigger callbacks on multiparm blocks. As a workaround, you must ALWAYS use the multiparm controller to change the number of multiparm values in your block. JADL will automatically update the multiparm block's instance count field to match whatever number set in the multiparm controller. So for example, if you set the multiparm controller field to '3', you should see your multiparm block update to contain 3 multiparm instances.



> [!important]
>
> Remember, you should not use the Multiparm instance controls AT ALL- this includes the 'clear' button. If you want to clear the multiparm block, simply set the multiparm controller value to 0.



### PDG Usage

In order to load JADL definitions inside pdg, first follow the steps outlined above for adding basic controls. Then install the JADL PDG controls as well.

*  To find out which controls file is supported by your version of JADL, open the python shell (Windows->Python Shell), and run `__import__('jadl').about()`.



Next, add a python node inside your HDA/subnet containing the following:

```py
import jadl

this_node = hou.pwd()
loader_node = this_node.parent()
generator_node = loader_node.parent()
jadl.load_detail_attributes(generator_node, this_node, loader_node.evalParm('asset_index'))
```



This code will load an asset definition based on its integer index and will write all the associated values to detail attributes. You can then use these detail attributes to drive your asset.



From here, you can set up PDG to create work items for each item in the JSON file. Create a [genericgenerator](https://www.sidefx.com/docs/houdini/nodes/top/genericgenerator.html) node with an item count of 1. Attach it to a [pythonprocessor](https://www.sidefx.com/docs/houdini/nodes/top/pythonprocessor.html) node with the following script:

```py
import hou
import jadl

node = hou.pwd()

json_file_path = self.scheduler.localizePath(node.evalParm('json_file_path'))
jadl.generate_work_items(node, item_holder, json_file_path)
```



Calling generate_work_items will automatically create a work item for each asset in the JSON file, and will add the following TOP attributes:

* `@asset_name`
* `@asset_index`



Finally, wire the pythonprocessor node to an [HDA processor](https://www.sidefx.com/docs/houdini/nodes/top/hdaprocessor.html), point it to your JADL-enabled HDA, and set the value of the **Asset Index** param (PDG Controls -> Asset Index) to `@asset_index`.
